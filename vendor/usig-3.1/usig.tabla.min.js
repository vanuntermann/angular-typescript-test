(function(a){a.fn.tabla=function(d){var n=a.extend({},a.fn.tabla.defaults,d);var e=0;var r=null;var k={};var q=new Array();var m=a(this);var c=null;var s=null;var g=null;function o(t){if(window.console&&window.console.log){window.console.log(t)}}function l(){c=a(document.createElement("table"));c.attr("cellpadding",0);c.attr("cellspacing",0);if(typeof(n.cls)!="undefined"){c.addClass(n.cls)}var t=a(document.createElement("tr"));a(n.columns).each(function(){var v=this.name;q.push(v);var u=a(document.createElement("th"));if(typeof(this.width)!="undefined"){u.attr("width",this.width)}if(typeof(this.cls)!="undefined"){u.addClass(this.cls)}if(typeof(this.title)!="undefined"){u.attr("title",this.title)}u.html(this.label);t.append(u);if(typeof(this.onHeaderClick)!="undefined"){var y=typeof(this.onHeaderClick)=="string"?this.onHeaderClick:this.onHeaderClick.action;var x=this.onHeaderClick.before;var z=this.onHeaderClick.after;var w=this.onHeaderClick.data;switch(y){case"propagate":u.click(function(){if(typeof(x)=="function"){x(a(this))}if(typeof(w)=="function"){g=w(a(this))}else{if(typeof(w)!="undefined"){g=w}}s.find("td").filter(function(){return a(this).data("name")==v}).trigger("click",g);if(typeof(z)=="function"){z(a(this))}g=null});break;case"sort":alert("Lo siento. El sort no está implementado todavía :-(");break}}});c.append(a(document.createElement("thead")).append(t));s=a(document.createElement("tbody"));c.append(s);m.append(c)}function b(A,t,y,B){var x=a(document.createElement("tr"));var v=e>0?1:0;if(e>0){e--}a(A).each(function(D){var C=a(document.createElement("td"));C.data("name",n.columns[(D+v)].name);if(typeof(n.columns[(D+v)].cls)!="undefined"&&this.classes==undefined){C.addClass(n.columns[(D+v)].cls)}if(this.classes){C.addClass(this.classes)}if(typeof(n.columns[(D+v)].onclick)=="function"){C.click(function(E,F){n.columns[(D+v)].onclick(a(this).parent("tr").data("id"),a(this),a(this).parent("tr").data("props"),F)});C.css("cursor",n.clickableCursor)}if(typeof(this.text)!="undefined"){if(typeof(this.rowspan)!="undefined"){if(D!=0){alert("Los rowspan solo están soportados para la primera columna.")}C.attr("rowspan",this.rowspan);if(e>0){alert("No están soportados múltiples rowspan simultáneos y cruzados.")}e=this.rowspan-1;x.data("rowSpanTd",C);x.data("rowSpanChilds",0);r=x}if(typeof(this.colspan)!="undefined"){C.attr("colspan",this.colspan)}if(typeof(this.title)!="undefined"){C.attr("title",this.title)}C.html(this.text)}else{C[0].innerHTML=this}x.append(C)});if(v>0){x.data("rowSpanHead",r);var w=r.data("rowSpanChilds");r.data("rowSpanChilds",++w)}var u=(typeof(t)!="undefined")?t:0;var z=(typeof(y)!="undefined")?y:{};if(B&&k[B]){k[B].after(x)}else{s.append(x)}k[u]=x;x.data("id",u).data("props",z);return x}function i(u){if(typeof(k[u])!="undefined"){if(k[u].data("rowSpanChilds")>0){k[u].next("tr").prepend(k[u].data("rowSpanTd").clone()).data("rowSpanChilds",k[u].data("rowSpanChilds")-1).data("rowSpanTd",k[u].data("rowSpanTd").clone())}if(typeof(k[u].data("rowSpanHead"))!="undefined"){var t=r.data("rowSpanChilds");r.data("rowSpanChilds",--t)}k[u].remove();k[u]=undefined;return true}return false}function h(u,t){if(typeof(n.columns[jQuery.inArray(u,q)])!="undefined"&&typeof(t)=="function"){n.columns[jQuery.inArray(u,q)].onclick=t;s.find("tr").find("td").filter(function(){return a(this).data("name")==u}).unbind("click").click(function(v,w){t(a(this).parent("tr").data("id"),a(this),a(this).parent("tr").data("props"),w)}).css("cursor",n.clickableCursor);return true}return false}function j(u,t,v){if(typeof(n.columns[jQuery.inArray(t,q)])&&typeof(k[u])!="undefined"){k[u].find("td").filter(function(){return a(this).data("name")==t}).html(v)}}function p(v,u,t){if(typeof(n.columns[jQuery.inArray(u,q)])&&typeof(k[v])!="undefined"){k[v].find("td").filter(function(){return a(this).data("name")==u}).addClass(t)}}function f(v,u,t){if(typeof(n.columns[jQuery.inArray(u,q)])&&typeof(k[v])!="undefined"){k[v].find("td").filter(function(){return a(this).data("name")==u}).removeClass(t)}}l();return{addRow:b,removeRow:i,onClick:h,updateCell:j,addClassToCell:p,removeClassToCell:f}};a.fn.tabla.defaults={clickableCursor:"pointer"}})(jQuery);