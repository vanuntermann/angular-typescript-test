if(typeof(usig)=="undefined"){usig={}}if(typeof(usig.debug)=="undefined"){usig.debug=function(a){if(window.console&&window.console.log){window.console.log(a)}}}usig.FotosParcela=(function(a){return function(c,b){var f=/[0-9][0-9]-[0-9]{3,3}[A-Z]?-[A-Z0-9]{3,4}/;if(typeof(c)=="undefined"||!f.test(c)){usig.debug("usig.FotosParcela. SMP incorrecto: "+c);return null}var m=a.extend(true,{},usig.FotosParcela.defaults,b);var k=null;var d=-1;var j=new Array();var i=new Array();var l={};if(typeof(m.onLoad)=="function"){i.push(m.onLoad)}if(typeof(usig.DataManager)!="undefined"){if(!usig.DataManager.isRegistered("DatosFotosParcela")){usig.DataManager.registerClass("DatosFotosParcela",{ajaxParams:{url:usig.FotosParcela.defaults.server+"/getDatosFotos"}})}if(!usig.DataManager.isRegistered("FotoParcela")){usig.DataManager.registerClass("FotoParcela",{getter:function(o,q,p){var n=document.createElement("img");n.src=usig.FotosParcela.defaults.server+"/getFoto?"+p.join("&");usig.DataManager.storeData(o,q,n);return n}})}usig.DataManager.getData.defer(100,usig.DataManager,["DatosFotosParcela",c,{smp:c,success:h.createDelegate(this)}])}else{a.ajax({type:"GET",url:usig.FotosParcela.defaults.server+"/getDatosFotos",data:{smp:c},dataType:"jsonp",success:h.createDelegate(this),error:function(o,n){usig.debug("Hubo un error al buscar los datos de las fotos: "+n)}})}function h(o){if(o){k=o;if(k&&k.length>0){d=0}for(var n=0;n<i.length;n++){i[n]()}}}this.cargarFoto=function(t,u,o){if(k||typeof(u)=="undefined"){if(d>=0||typeof(u)=="undefined"){var s=new Array();var r=e(s,u,o);if(j.indexOf(t)>=0){j.removeObject(t);t.html("")}if(typeof(usig.DataManager)!="undefined"){var n=null;if(usig.DataManager.isCached("FotoParcela",r)){n=usig.DataManager.getData("FotoParcela",r,s);var q=a(n).clone();a(q).appendTo(t);if(o&&o.onLoad&&typeof(o.onLoad)=="function"){o.onLoad(q)}}else{n=usig.DataManager.getData("FotoParcela",r,s);t.html("<p>"+usig.FotosParcela.defaults.texts.loadingFoto+"</p>");a(n).load((function(){t.html("");t.append(usig.DataManager.getData("FotoParcela",r,s));if(o&&o.onLoad&&typeof(o.onLoad)=="function"){o.onLoad(n)}}).createDelegate(this))}}else{if(!l[r]){var p=new Date();s.push("t="+p);l[r]=document.createElement("img");l[r].src=usig.FotosParcela.defaults.server+"/getFoto?"+s.join("&");t.html("<p>"+usig.FotosParcela.defaults.texts.loadingFoto+"</p>");a(l[r]).load((function(v){t.html("");t.append(v);if(o&&o.onLoad&&typeof(o.onLoad)=="function"){o.onLoad(v)}}).createDelegate(this,[l[r]]))}else{t.append(l[r]);if(o&&o.onLoad&&typeof(o.onLoad)=="function"){o.onLoad(l[r])}}}}else{t.html("<p>"+m.texts.noFotos+"</p>")}}else{if(j.indexOf(t)<0){j.push(t);t.html("<p>"+m.texts.loading+"</p>")}setTimeout(this.cargarFoto.createDelegate(this,[t,u,o]),500)}};this.getLinkToFoto=function(p,n){var o=new Array();e(o,p,n);return usig.FotosParcela.defaults.server+"/getFoto?"+o.join("&")};this.onLoad=function(n){if(typeof(n)=="function"){i.push(n)}else{usig.debug("listener debe ser una funcion.")}};this.numFotos=function(){if(k){return k.length}else{return -1}};this.fotoSiguiente=function(){d=g(d,-1,k.length-1);return d};this.fotoAnterior=function(){d=g(d,1,k.length-1);return d};this.fechaFoto=function(n){if(k){if(d>=0){if(typeof(n)=="undefined"){n=d}return k[n].fecha}else{return""}}};this.anioFoto=function(n){if(k){if(d>=0){if(typeof(n)=="undefined"){n=d}return k[n].fecha.substr(6,4)}else{return""}}};this.setFechaFoto=function(n,o){if(k){n.html(this.fechaFoto(o))}else{setTimeout(this.setFechaFoto.createDelegate(this,[n,o]),1000)}};this.getSMP=function(){return c};this.getDatosFoto=function(n){if(k[n]){return k[n]}return null};this.getServerUrl=function(){return m.server};this.getCurrentFoto=function(){return d};this.getDatosFotos=function(){if(k){return k}else{return{}}};function g(n,o,q){var p=n+o;if(p>q){p=0}if(p<0){p=q}return p}function e(p,q,n){if(typeof(q)=="undefined"&&k){q=d}else{if(!k||(k&&!k[q])){q=0}}var o=c+q;p.push("smp="+c,"i="+q);if(typeof(n)!="undefined"&&typeof(n.maxWidth)!="undefined"&&!isNaN(parseInt(n.maxWidth))){p.push("w="+parseInt(n.maxWidth));o+=n.maxWidth}else{p.push("w="+parseInt(m.maxWidth));o+=m.maxWidth}if(typeof(n)!="undefined"&&typeof(n.maxHeight)!="undefined"&&!isNaN(parseInt(n.maxHeight))){p.push("h="+parseInt(n.maxHeight));o+=n.maxHeight}else{p.push("h="+parseInt(m.maxHeight));o+=m.maxHeight}return o}}})(jQuery);usig.FotosParcela.defaults={server:"//fotos.usig.buenosaires.gob.ar/",maxWidth:200,maxHeight:200,texts:{loading:"Cargando...",loadingFoto:"Cargando foto...",noFotos:"No hay fotos disponibles para esta parcela."}};