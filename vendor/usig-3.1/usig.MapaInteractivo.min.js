jQuery.extendIf=function(b,d){if(b&&d){for(var a in d){if(typeof b[a]=="undefined"){b[a]=d[a]}}}return b};if(typeof(Ext)=="undefined"){jQuery.extend(Function.prototype,{createCallback:function(){var a=arguments;var b=this;return function(){return b.apply(window,a)}},createDelegate:function(c,b,a){var d=this;return function(){var f=b||arguments;if(a===true){f=Array.prototype.slice.call(arguments,0);f=f.concat(b)}else{if(typeof a=="number"){f=Array.prototype.slice.call(arguments,0);var e=[a,0].concat(b);Array.prototype.splice.apply(f,e)}}return d.apply(c||window,f)}},defer:function(c,e,b,a){var d=this.createDelegate(e,b,a);if(c){return setTimeout(d,c)}d();return 0},createSequence:function(b,a){if(typeof b!="function"){return this}var c=this;return function(){var d=c.apply(this||window,arguments);b.apply(a||this||window,arguments);return d}},createInterceptor:function(b,a){if(typeof b!="function"){return this}var c=this;return function(){b.target=this;b.method=c;if(b.apply(a||this||window,arguments)===false){return}return c.apply(this||window,arguments)}}});jQuery.extendIf(String,{escape:function(a){return a.replace(/('|\\)/g,"\\$1")},leftPad:function(d,b,c){var a=new String(d);if(!c){c=" "}while(a.length<b){a=c+a}return a.toString()},format:function(b){var a=Array.prototype.slice.call(arguments,1);return b.replace(/\{(\d+)\}/g,function(c,d){return a[d]})}})}String.prototype.isInteger=function(){return !isNaN(parseInt(this))};String.prototype.isFloat=function(){return !isNaN(parseFloat(this))};String.prototype.toggle=function(b,a){return this==b?a:b};String.prototype.trim=function(){var a=/^\s+|\s+$/g;return function(){return this.replace(a,"")}}();String.prototype.translate=function(d,c){if(!(d.length&&c.length)||d.length!=c.length){return this}var b=this;for(var a=0;a<d.length;a++){if(typeof(d)=="string"){b=b.replace(new RegExp(d.charAt(a),"g"),c.charAt(a))}else{b=b.replace(new RegExp(d[a],"g"),c[a])}}return b};String.prototype.isDigit=function(){return/^\d+$/.test(this)};String.prototype.removeWords=function(e){var d=this.split(" ");var c=new Array();for(var b=0;b<d.length;b++){c.push(d[b]);for(var a=0;a<e.length;a++){if(c[b]==e[a]){c.pop();break}}}return c.join(" ")};jQuery.extendIf(Number.prototype,{constrain:function(b,a){return Math.min(Math.max(this,b),a)},isInteger:function(){return !isNaN(parseInt(this))},isFloat:function(){return !isNaN(parseFloat(this))}});jQuery.extendIf(Array.prototype,{indexOf:function(c){for(var b=0,a=this.length;b<a;b++){if(this[b]==c){return b}}return -1},removeObject:function(b){var a=this.indexOf(b);if(a!=-1){this.splice(a,1)}return this},binarySearch:function binarySearch(f,b){var a=0,e=this.length-1,c,d;while(a<=e){c=parseInt((a+e)/2,10);d=b(this[c],f);if(d<0){a=c+1;continue}if(d>0){e=c-1;continue}return c}return -1},inject:function(c,b){for(var a=0;a<this.length;a++){c=b(c,this[a],a)}return c},map:function(d,c){var a=new Array(this.length);for(var b=0,e=this.length;b<e;b++){if(b in this){a[b]=d.call(c,this[b],b,this)}}return a},intersect:function(){if(!arguments.length){return[]}var e=this;var d=a2=null;var h=0;while(h<arguments.length){d=[];a2=arguments[h];var c=e.length;var b=a2.length;for(var g=0;g<c;g++){for(var f=0;f<b;f++){if(e[g]===a2[f]){d.push(e[g])}}}e=d;h++}return d.unique()},unique:function(){var c=[];var b=this.length;for(var e=0;e<b;e++){for(var d=e+1;d<b;d++){if(this[e]===this[d]){d=++e}}c.push(this[e])}return c}});Date.prototype.getElapsed=function(a){return Math.abs((a||new Date()).getTime()-this.getTime())};if(typeof(usig)=="undefined"){usig={}}usig.debug=function(a){if(window.console&&window.console.log){window.console.log(a)}};if(typeof(usig)=="undefined"){usig={}}jQuery.extendIf(usig,{loadingJs:[],loadingJsListeners:{},__callLoadJsListeners:function(b){for(var c=0,a=usig.loadingJsListeners[b].length;c<a;c++){usig.loadingJsListeners[b][c]()}},loadJs:function(b,e){if(usig.loadingJs.indexOf(b)<0){usig.loadingJs.push(b);usig.loadingJsListeners[b]=(typeof(e)=="function")?[e]:[];var a=document.createElement("script"),c=document.getElementsByTagName("head")[0],d=false;a.onload=a.onreadystatechange=function(){if((a.readyState&&a.readyState!=="complete"&&a.readyState!=="loaded")||d){return false}a.onload=a.onreadystatechange=null;d=true;usig.__callLoadJsListeners(b)};a.src=b;c.insertBefore(a,c.firstChild)}else{usig.loadingJsListeners[b].push(e)}},loadCss:function(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",a);if(typeof b!="undefined"){document.getElementsByTagName("head")[0].appendChild(b)}},removeJs:function(a){var c=document.getElementsByTagName("script");for(var b=c.length;b>=0;b--){if(c[b]&&c[b].getAttribute("src")!=null&&c[b].getAttribute("src").indexOf(a)!=-1){c[b].parentNode.removeChild(c[b])}}},removeCss:function(a){var c=document.getElementsByTagName("link");for(var b=c.length;b>=0;b--){if(c[b]&&c[b].getAttribute("href")!=null&&c[b].getAttribute("href").indexOf(a)!=-1){c[b].parentNode.removeChild(c[b])}}},Animator:function(c,d,e,f){var b=0;function a(){if(c.length>b){d(c[b]);b++;setTimeout(a,e)}else{if(typeof(f)=="function"){f()}}}this.stop=function(){b=c.length+1};a()},parseUri:function(e){var a=["source","protocol","authority","domain","port","path","directoryPath","fileName","query","anchor"],b=new RegExp("^(?:([^:/?#.]+):)?(?://)?(([^:/?#]*)(?::(\\d*))?)((/(?:[^?#](?![^?#/]*\\.[^?#/.]+(?:[\\?#]|$)))*/?)?([^?#/]*))?(?:\\?([^#]*))?(?:#(.*))?").exec(e),d={};for(var c=0;c<10;c++){d[a[c]]=(b[c]?b[c]:"")}if(d.directoryPath.length>0){d.directoryPath=d.directoryPath.replace(/\/?$/,"/")}return d},registeredSuggesters:{},registerSuggester:function(a,b){usig.registeredSuggesters[a]=b},createSuggester:function(b,a){if(typeof(usig.registeredSuggesters[b])!="function"){throw"Suggester "+b+" is not registered.";return null}return new usig.registeredSuggesters[b](a)}});jQuery.expr[":"].Contains=function(c,d,b){return jQuery(c).text().toUpperCase().indexOf(b[3].toUpperCase())>=0};jQuery.expr[":"].ContainsFilter=function(c,d,b){if(c.innerHTML.indexOf("data-filter")>=0){var e=c.innerHTML.match(/data-filter\=\"(.*?)\"/)[1].toUpperCase().indexOf(b[3].toUpperCase())>=0}return jQuery(c).text().toUpperCase().indexOf(b[3].toUpperCase())>=0||e};if(typeof(usig)=="undefined"){usig={}}usig.MapaInteractivo=(function(a){return function(S,t){var w=a.extend({},usig.MapaInteractivo.defaults,t),E=a("#"+S),o=parseInt(E.css("width")),L=parseInt(E.css("height")),x={},I={},C={},e=null,q=false,F=false,m=this,p=null,z=[],O=[],G=[],v=a('<div class="indicator" style="-moz-border-radius: 10px; -webkit-border-radius: 10px; border-radius: 10px;"></div>'),y=null,g=null,B=null,b=null,Q=null,P=null,H=null,J=null,s=null,n=null;function N(){v.remove();w.OpenLayersOptions.maxExtent=new OpenLayers.Bounds(w.bounds[0],w.bounds[1],w.bounds[2],w.bounds[3]);w.OpenLayersOptions.initBounds=new OpenLayers.Bounds(w.initBounds[0],w.initBounds[1],w.initBounds[2],w.initBounds[3]);y=new OpenLayers.Map(S,w.OpenLayersOptions);a("div.olMapViewport",E).append(v);this.api=y;this.api.zoomToMaxExtent=function(W){this.zoomToExtent(w.OpenLayersOptions.initBounds)};b=new OpenLayers.Control.ScaleBar({minWidth:141,maxWidth:142});y.addControl(b);if(w.includePanZoomBar){B=new OpenLayers.Control.PanZoomBarUSIG({zoomBar:w.zoomBar});y.addControl(B)}if(w.includeToolbar){var V=a.extend({},w.texts.navBar,{clickHandler:w.onMapClick});if(!w.zoomBar){V.top=90}g=new OpenLayers.Control.NavToolbarUSIG(V);y.addControl(g);this.toolbar=g}else{y.addControl(new OpenLayers.Control.Navigation())}if(w.includeMapSwitcher){var U=a.extend({},w.MapSwitcherOptions,{onOptionToggle:(function(X,W){if(X=="markers-toggle"&&H){this.toggleLayer(H)}}).createDelegate(this),onMapSelection:(function(W){this.setBaseLayer(W)}).createDelegate(this)},w.mapSwitcher);this.mapSwitcher=new OpenLayers.Control.MapSelector(U);y.addControl(this.mapSwitcher)}P=new OpenLayers.Control.StatusBar();y.addControl(P);y.addControl(new OpenLayers.Control.MousePosition({formatOutput:function(W){return""}}));H=new OpenLayers.Layer.Vector("MyMarkers",{styleMap:new OpenLayers.StyleMap({"default":{externalGraphic:w.rootUrl+"images/marker-3.0.png",graphicWidth:32,graphicHeight:42,graphicXOffset:-16,graphicYOffset:-36,graphicZIndex:w.MARKER_Z_INDEX,cursor:"pointer"},select:{graphicWidth:38,graphicHeight:50,graphicXOffset:-19,graphicYOffset:-43}}),rendererOptions:{yOrdering:true}});y.addLayer(H);s=new OpenLayers.Control.SelectFeature([H],{hover:true,highlightOnly:true});J=new OpenLayers.Control.SelectFeature([H],{clickout:true,toggle:false,multiple:false,hover:false,toggleKey:"ctrlKey",multipleKey:"shiftKey"});n=OpenLayers.Class(OpenLayers.Popover.Anchored,{autoSize:true,panMapIfOutOfView:true,minSize:new OpenLayers.Size(100,70),maxSize:new OpenLayers.Size(340,550),displayClass:"popover"});H.events.on({featureselected:function(Z){var X=x[Z.feature.attributes.fid];var Y=X.feature;var W=null;if(X.place.options.popup){W=new n(Z.feature.id,new OpenLayers.LonLat(Z.feature.geometry.x,Z.feature.geometry.y),null,X.popupContent,null,false,function(){J.unselect(Y)});Z.feature.popup=W;W.hide();y.addPopup(W,true)}if(typeof(X.onClick)=="function"){X.onClick(Z,X.place,W,J)}else{if(W){W.show();W.updateSize()}}if(!W){J.unselect(Y)}},featureunselected:function(W){if(W.feature&&W.feature.popup){y.removePopup(W.feature.popup);W.feature.popup.destroy();W.feature.popup=null}}});y.addControl(s);y.addControl(J);s.activate();J.activate();if(w.initLocation){this.loadMap(w.initLocation.mapConfig)}else{this.setBaseLayer(w.baseLayer)}y.zoomToExtent(w.OpenLayersOptions.initBounds);if(w.initLocation){y.moveTo(new OpenLayers.LonLat(w.initLocation.lon,w.initLocation.lat),w.initLocation.zl)}else{y.zoomToExtent(w.OpenLayersOptions.initBounds)}if(typeof(w.onReady)=="function"){w.onReady(this)}if(w.trackVisits){var T=function(W){try{var Y=Piwik.getTracker(w.piwikBaseUrl+"piwik.php",W);Y.trackPageView();Y.enableLinkTracking()}catch(X){}};if(typeof(Piwik)=="undefined"){usig.loadJs(w.piwikBaseUrl+"piwik.js",T.createDelegate(this,[w.piwikSiteId]))}else{T(w.piwikSiteId)}}v.hide()}function f(){var T=usig.MapaInteractivo.defaults.OpenLayersJS.replace("OpenLayers.js","");a.each(w.preloadImages,function(V,U){z.push(a('<img src="'+T+U+'"/>'))})}function k(T){var U=new Array();a.each(w.servers,function(V,W){U.push(W+T)});return U}function j(){var V=-1;if(navigator.appName=="Microsoft Internet Explorer"){var T=navigator.userAgent;var U=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(U.exec(T)!=null){V=parseFloat(RegExp.$1)}}return V<=8}this.setOptions=function(T){w=a.extend({},w,T)};this.updateSize=function(){(function(){y.updateSize();v.css("left",(parseInt(E.css("width"))/2-26)+"px");v.css("top",(parseInt(E.css("height"))/2-26)+"px")}).defer(200,this)};this.getMarkers=function(){return x};this.unselectFeature=function(T){J.unselect(T)};this.selectFeature=function(T){J.select(T)};this.setBaseLayer=function(U){var T=y.baseLayer;if(T==undefined){this.addWMSLayer(U,{isBaseLayer:true})}else{if(T.name!=U){try{y.removeLayer(T)}catch(V){}this.addWMSLayer(U,{isBaseLayer:true})}}};function u(U){var T={style:null,lonlat:null};if(U instanceof OpenLayers.Marker){T={style:{externalGraphic:U.icon.url,backgroundGraphic:w.rootUrl+"images/blank.gif",graphicWidth:U.icon.size.w,graphicHeight:U.icon.size.h,graphicXOffset:U.icon.offset.x,graphicYOffset:U.icon.offset.y},lonlat:U.lonlat.clone()};U.destroy();return T}if(U.options&&U.options.iconUrl){T={style:{externalGraphic:U.options.iconUrl,backgroundGraphic:U.options.backgroundGraphic||w.rootUrl+"images/blank.gif",graphicWidth:U.options.iconWidth,graphicHeight:U.options.iconHeight,backgroundWidth:U.options.iconWidth,backgroundHeight:U.options.iconHeight,graphicXOffset:U.options.offsetX,graphicYOffset:U.options.offsetY}}}if(U.x!=undefined&&U.y!=undefined){T.lonlat=new OpenLayers.LonLat(U.x,U.y)}if(usig.Direccion&&U instanceof usig.Direccion){T.lonlat=new OpenLayers.LonLat(U.getCoordenadas().x,U.getCoordenadas().y)}if(usig.inventario&&usig.inventario.Objeto&&U instanceof usig.inventario.Objeto){T.lonlat=new OpenLayers.LonLat(U.ubicacion.getCentroide().x,U.ubicacion.getCentroide().y)}return T}function M(){if(usig.NormalizadorDirecciones){q=false;if(usig.NormalizadorDirecciones.listo()){r()}else{usig.NormalizadorDirecciones.init({onReady:M.createDelegate(this),loadFullDatabase:true})}}else{if(!q){q=true;usig.loadJs(w.NormalizadorDireccionesJS,M.createDelegate(this))}}}function r(){var T=0;if(usig.NormalizadorDirecciones&&usig.NormalizadorDirecciones.listo()){a.each(I,function(Y,X){try{var W=X.place;var U=usig.NormalizadorDirecciones.normalizar(W,10);if(U.length>0){X.place=U[0];C[Y]={place:X.place,goTo:X.goTo,onClick:X.onClick,options:X.options};T++}}catch(V){}delete I[Y]});if(T>0){D()}}else{M()}}function D(){if(e){a.each(C,function(V,U){var T=U.place;e.geoCodificarDireccion(T,function(W){U.place.setCoordenadas(W);A(U.place,V,U.goTo,U.onClick,U.options)});delete C[V]})}else{R()}}function R(){if(usig.GeoCoder){F=false;e=new usig.GeoCoder();D()}else{if(!F){F=true;usig.loadJs(w.GeoCoderJS,R.createDelegate(this))}}}function K(T,U){if(U){if(y.getZoom()==w.goToZoomLevel){y.panTo(new OpenLayers.LonLat(T.lon,T.lat))}else{y.moveTo(new OpenLayers.LonLat(T.lon,T.lat),w.goToZoomLevel)}}else{y.panTo(new OpenLayers.LonLat(T.lon,T.lat))}}function A(U,aa,X,Z,V){var Y={instantPopup:false,popup:true};P.activate(w.texts.processing,true);U.options=a.extend({},Y,V);if(typeof(Z)=="object"){U.options=a.extend({},Y,Z)}var T=u(U);var W=(U.toString()!="[object Object]"||typeof(U)=="string")?U:"Lon: "+T.lonlat.lon+", Lat: "+T.lonlat.lat;if(Z&&typeof(Z)!="function"&&typeof(Z)!="object"){W=Z}T.place=U;T.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(T.lonlat.lon,T.lonlat.lat),{fid:aa});T.feature.style=T.style;T.popupContent=W;T.onClick=typeof(Z)=="function"?Z:null;x[""+aa]=T;H.addFeatures(T.feature);if(X){K(T.lonlat,true)}if(U.options&&U.options.instantPopup){J.select(T.feature)}P.deactivate();return aa}function d(W){var T=W.getPlan();if(T instanceof Array){var U=usig.GMLPlan.create("trip_plan_"+W.getId(),{template:W.getTemplate(),baseUrl:w.rootUrl,tipoRecorrido:W.getTipo()});for(i=0;i<T.length;i++){var V=T[i];if(V.type!=undefined){if(V.type=="StartWalking"||V.type=="FinishWalking"){if(i==0){U.addMarker(V.gml.replace("walk","beginwalk"))}else{U.addMarker(V.gml)}}else{if(V.type=="Board"){if(i==0){U.addMarker(V.gml.replace(/(bus|subway|train)/g,"begin$1"))}else{if(V.service_type=="1"){switch(V.service){case"Línea A":V.gml=V.gml.replace("subway","subwayA");break;case"Línea B":V.gml=V.gml.replace("subway","subwayB");break;case"Línea C":V.gml=V.gml.replace("subway","subwayC");break;case"Línea D":V.gml=V.gml.replace("subway","subwayD");break;case"Línea E":V.gml=V.gml.replace("subway","subwayE");break;case"Línea H":V.gml=V.gml.replace("subway","subwayH");break}}U.addMarker(V.gml)}}else{if(V.type=="Bus"||V.type=="SubWay"||V.type=="Street"){U.addEdges([V.gml])}else{if(V.type=="SubWayConnection"){switch(V.service_to){case"Línea A":V.gml[1]=V.gml[1].replace("connection","subwayA");break;case"Línea B":V.gml[1]=V.gml[1].replace("connection","subwayB");break;case"Línea C":V.gml[1]=V.gml[1].replace("connection","subwayC");break;case"Línea D":V.gml[1]=V.gml[1].replace("connection","subwayD");break;case"Línea E":V.gml[1]=V.gml[1].replace("connection","subwayE");break;case"Línea H":V.gml[1]=V.gml[1].replace("connection","subwayH");break}U.addMarker(V.gml[1]);U.addEdges(V.gml)}else{if(V.type=="StartDriving"||V.type=="FinishDriving"){U.addMarker(V.gml)}else{if(V.type=="StartBiking"||V.type=="FinishBiking"){if(i==0){U.addMarker(V.gml.replace("bike","beginbike"))}else{U.addMarker(V.gml)}}}}}}}}}W.gmlLayer=U;return U}return false}function h(V){var U=y.getLayersByName(V.gmlLayer.name);if(U.length>0){for(l=0;l<U.length;l++){U[l].setVisibility(true)}}else{var T=V.gmlLayer;T.setVisibility(true);y.addLayer(T);y.setLayerZIndex(T,80)}y.zoomToExtent(V.gmlLayer.getDataExtent())}this.addMarker=function(T,W,X,U){var V=Math.floor(Math.random()*100001);var Y=new Date()*1+V;if(typeof(T)=="string"){I[Y]={place:T,goTo:W,onClick:X,options:U};r();return Y}return A(T,Y,W,X,U)};this.removeMarker=function(V){var T=x[""+V];if(T){try{J.unselect(T.feature)}catch(U){}H.removeFeatures(T.feature)}T=undefined;x[V]=undefined;delete x[V]};this.toggleMarker=function(V,U){var T=x[""+V];if(U){H.getFeatureById(T.feature.id).style=T.style}else{H.getFeatureById(T.feature.id).style=a.extend({},T.style,{display:"none"})}H.redraw()};this.goToMarker=function(V,U){var T=x[""+V];K(T.lonlat,U)};this.goTo=function(T,U){K(T,U)};this.showStatus=function(U,T){P.activate(U,T)};this.hideStatus=function(){P.deactivate()};this.showIndicator=function(){v.show()};this.hideIndicator=function(){v.hide()};this.raiseMarkers=function(T){if(H){y.raiseLayer(H,T)}};this.getMarkersIndex=function(){return y.getLayerIndex(H)};this.getMarkersZIndex=function(){return H.getZIndex()};this.getMarker=function(T){return x[""+T]};this.getMarkersLayer=function(){return H};this.zoomToMarkers=function(){if(H.features.length>1){y.zoomToExtent(H.getDataExtent())}};this.mostrarRecorrido=function(T){if(!T.gmlLayer){T.getDetalle(function(){if(d(T)){h(T)}})}else{h(T)}};this.ocultarRecorrido=function(T){if(T.gmlLayer){T.gmlLayer.setVisibility(false)}};this.existeLayer=function(U){if(U.gmlLayer){var T=y.getLayersByName(U.gmlLayer.name);return(T.length>0)}return false};this.borrarRecorrido=function(T){if(T.gmlLayer){y.removeLayer(T.gmlLayer)}};function c(T){T.defaultStyle=a.extend({},T.defaultStyle,T.symbolizer);if(!T.selectStyle){T.selectStyle=a.extend({},T.defaultStyle);T.selectStyle.externalGraphic=undefined;T.selectStyle.backgroundGraphic=undefined;T.selectStyle.fillColor=undefined;T.selectStyle.strokeColor=undefined}var V=new OpenLayers.StyleMap({"default":T.defaultStyle,select:T.selectStyle});var U=new Array();a.each(T.escalas,function(X,W){if(T.symbolizer.graphicWidth&&T.symbolizer.graphicHeight){W.symbolizer.graphicWidth=parseInt(Math.round(T.symbolizer.graphicWidth*W.symbolizer.size));W.symbolizer.graphicHeight=parseInt(Math.round(T.symbolizer.graphicHeight*W.symbolizer.size));if(T.symbolizer.backgroundWidth&&T.symbolizer.backgroundHeight){W.symbolizer.backgroundWidth=parseInt(Math.round(T.symbolizer.backgroundWidth*W.symbolizer.size));W.symbolizer.backgroundHeight=parseInt(Math.round(T.symbolizer.backgroundHeight*W.symbolizer.size))}}else{W.symbolizer.pointRadius=Math.max(parseInt(Math.round(T.selectStyle.pointRadius*W.symbolizer.size)),T.minPointRadius);W.symbolizer.strokeWidth=Math.max(parseInt(Math.round(T.selectStyle.strokeWidth*W.symbolizer.size)),T.minPointRadius);W.symbolizer.fontSize=Math.max(parseInt(Math.round(parseInt(T.selectStyle.fontSize)*W.symbolizer.size)),parseInt(T.minFontSize))+"px"}if(T.symbolizer.graphicXOffset&&T.symbolizer.graphicYOffset){W.symbolizer.graphicXOffset=parseInt(Math.round(T.symbolizer.graphicXOffset*W.symbolizer.size));W.symbolizer.graphicYOffset=parseInt(Math.round(T.symbolizer.graphicYOffset*W.symbolizer.size))}if(T.symbolizer.backgroundXOffset&&T.symbolizer.backgroundYOffset){W.symbolizer.backgroundXOffset=parseInt(Math.round(T.symbolizer.backgroundXOffset*W.symbolizer.size));W.symbolizer.backgroundYOffset=parseInt(Math.round(T.symbolizer.backgroundYOffset*W.symbolizer.size))}a.each(T.clases,function(Y,aa){if(!(aa.filter instanceof OpenLayers.Filter)){aa.filter=new OpenLayers.Filter.Comparison(aa.filter)}var Z=a.extend({},aa.symbolizer,W.symbolizer);if(!aa.symbolizer){Z.fillColor=T.colors[Y]}U.push(new OpenLayers.Rule(a.extend({},aa,W,{symbolizer:Z})))});U.push(new OpenLayers.Rule(a.extend({},W,{elseFilter:true})))});V.styles["default"].addRules(U);return V}this.addVectorLayer=function(U,T){var X=a.extend(true,{},usig.MapaInteractivo.defaults.vectorLayer,T);if(X.onClick&&!X.symbolizer.cursor){X.symbolizer.cursor="pointer"}var V=new OpenLayers.Layer.Vector(U,{styleMap:c(X),visibility:X.visible,minScale:X.minScale,maxScale:X.maxScale,rendererOptions:{yOrdering:false,zIndexing:true}});y.addLayer(V);this.raiseMarkers(y.layers.length);y.setLayerZIndex(V,X.zIndex);if(X.url&&X.url!=""){this.showIndicator();var W=X.format.toUpperCase()=="GML"?"xml":"json";a.ajax({url:X.url,dataType:(window.location.host==usig.parseUri(X.url).authority)||(usig.parseUri(X.url).authority==X.url)?W:"jsonp",success:(function(ab){if(X.format.toUpperCase()=="GML"){var aa=new OpenLayers.Format.GML();V.addFeatures(aa.read(ab))}else{if(X.format.toUpperCase()=="GEOJSON"){var Z=new OpenLayers.Format.GeoJSON();V.addFeatures(Z.read(ab))}}if(typeof(X.onLoad)=="function"){X.onLoad()}this.hideIndicator()}).createDelegate(this),error:function(Z){}})}if(X.onClick&&!X.disableClick){if(X.highlightable){var Y=s.layers;Y.push(V);s.setLayer(Y)}var Y=J.layers;Y.push(V);J.setLayer(Y);V.events.on({featureselected:function(ab){var aa=ab.feature;ab.layerName=U;if(X.popup){var Z=new n(ab.feature.id,y.getLonLatFromPixel(y.getControlsByClass("OpenLayers.Control.MousePosition")[0].lastXy),null,'<div id="contenido_'+ab.feature.id+'"></div>',null,false,function(ac){J.unselect(aa);ac.cancelBubble=true;return false});ab.feature.popup=Z;Z.hide();y.addPopup(Z,true)}if(typeof(X.onClick)=="function"){X.onClick(ab,Z)}else{if(Z){Z.show()}}if(!Z){J.unselect(aa)}},featureunselected:function(Z){if(Z.feature.popup){y.removePopup(Z.feature.popup);Z.feature.popup.destroy();Z.feature.popup=null}}})}return V};this.addWMSLayer=function(U,T){var W=a.extend({},usig.MapaInteractivo.defaults.wmsLayer,T);if(!W.layerUrls){W.layerUrls=k(U)}if(!W.layers){W.layers=U}var V=new OpenLayers.Layer.WMS(U,W.layerUrls,{layers:W.layers,format:W.format,transparent:W.transparent},{transitionEffect:W.transitionEffect,buffer:W.buffer,opacity:j()?1:W.opacity,singleTile:W.singleTile,isBaseLayer:W.isBaseLayer,minScale:W.minScale,maxScale:W.maxScale});y.addLayer(V);return V};this.addLayerToSelectControl=function(T){var U=J.layers;if(U.indexOf(T)<0){U.push(T);J.setLayer(U)}};this.removeLayer=function(T){try{y.removeLayer(T);var V=s.layers;V.removeObject(T);s.setLayer(V);V=J.layers;V.removeObject(T);J.setLayer(V);T.destroy()}catch(U){return U}return true};this.toggleLayer=function(U,T){if(typeof(T)=="undefined"){U.setVisibility(!U.visibility)}else{U.setVisibility(T)}};this.toggleMarkers=function(){this.toggleLayer(H)};this.loadMap=function(U){this.removeVectorLayers();this.removeWMSLayers();if(U.baseLayer){this.setBaseLayer(U.baseLayer)}if(U.layers){var T=this;a.each(U.layers,function(W,V){if(V.options.format.toUpperCase()=="WMS"){G.push(T.addWMSLayer(V.name,V.options))}else{if(V.options.popup==undefined){V.options.popup=U.popup}if(V.options.onClick==undefined){V.options.onClick=U.onClick}O.push(T.addVectorLayer(V.name,V.options))}})}};this.removeVectorLayers=function(){for(var U=0,T=O.length;U<T;U++){this.removeLayer(O[U])}O=[]};this.removeWMSLayers=function(){for(var U=0,T=G.length;U<T;U++){this.removeLayer(G[U])}G=[]};if(typeof(OpenLayers)=="undefined"){p=a('<img src="'+w.rootUrl+'images/animated_indicator_medium.gif" alt="'+w.texts.loading+'"/>');p.css("padding","10px");v.css("background-color","#fff").css("width","52px").css("height","52px").css("border","1px solid #ddd").css("position","relative").css("zIndex","1000").css("opacity","0.85").css("left",(o/2-26)+"px").css("top",(L/2-26)+"px").append(p);E.css("background-color","#eee").append(v);usig.loadCss(w.OpenLayersCSS);usig.loadJs(w.OpenLayersJS,N.createDelegate(this));(function(){if(typeof(OpenLayers)=="undefined"){f()}}).defer(500,this)}else{N.defer(200,this)}}})(jQuery);usig.MapaInteractivo.defaults={debug:false,trackVisits:true,includePanZoomBar:true,zoomBar:true,includeToolbar:true,includeMapSwitcher:false,bounds:[54340,54090,172855,140146],initBounds:[93500,96750,112000,106750],OpenLayersOptions:{controls:[],resolutions:[90,50,30,15,7.5,4,2,1,0.5,0.2],projection:"EPSG:221951",units:"m"},MapSwitcherOptions:{layers:[{name:"satellite",title:"vista satelital 2009",id:"mapabsas_imagen_satelital_2009"},{name:"default",title:"vista del mapa",id:"mapabsas_default3"}],opcionales:[{id:"markers-toggle",name:"Mostrar Mis Marcadores",checked:true}],mapas:[]},baseLayer:"mapabsas_informacion_basica",rootUrl:"//servicios.usig.buenosaires.gob.ar/usig-js/dev/",OpenLayersCSS:"//servicios.usig.buenosaires.gob.ar/OpenLayers/2.13-dev1-1/theme/default/style.css",OpenLayersJS:"//servicios.usig.buenosaires.gob.ar/OpenLayers/2.13-dev1-1/OpenLayers.js",NormalizadorDireccionesJS:"//servicios.usig.buenosaires.gob.ar/nd-js/1.4/normalizadorDirecciones.min.js",GeoCoderJS:"//servicios.usig.buenosaires.gob.ar/usig-js/3.1/usig.GeoCoder.min.js",piwikBaseUrl:"//usig.buenosaires.gob.ar/piwik/",piwikSiteId:3,preloadImages:[],texts:{processing:"Procesando...",loading:"Cargando...",tituloMailing:"Enviar vista actual por e-mail",mapSelectorDefault:"Vista del Plano",panZoomBar:{textAcercar:"Acercar",textAlejar:"Alejar",verMapaCompleto:"Ver el mapa completo"},overviewMap:{textMapaReferencia:"Mapa de referencia interactivo",textCerrar:"Cerrar"},navBar:{navigationText:"Mover",zoomBoxText:"Acercar",measureToolTexts:{buttonLabel:"Medir",measure:"Medida",measureDistance:"Medir Distancia",measureArea:"Medir Área"}}},vectorLayer:{format:"GML",highlightable:true,popup:false,visible:true,escalas:[{minScaleDenominator:80000,symbolizer:{size:0.4}},{minScaleDenominator:20000,maxScaleDenominator:80000,symbolizer:{size:0.5}},{maxScaleDenominator:20000,symbolizer:{size:0.7}}],clases:[],minPointRadius:3,minFontSize:"10px",symbolizer:{fillColor:"#0000ee",strokeColor:"#666666",strokeWidth:1,pointRadius:7,cursor:"pointer"},zIndex:0,colors:["#8F58C7","#E34900","#C3E401","#F9B528","#D71440","#007baf","#495a78","#b56c7d","#669966","#ff3300"]},wmsLayer:{format:"image/png",transitionEffect:"resize",buffer:0,opacity:1,singleTile:false,transparent:true,isBaseLayer:false,minScale:100000,maxScale:0},goToZoomLevel:7,SHADOW_Z_INDEX:10,MARKER_Z_INDEX:11,servers:["//tiles1.usig.buenosaires.gob.ar/tilecache/","//tiles2.usig.buenosaires.gob.ar/tilecache/","//tiles3.usig.buenosaires.gob.ar/tilecache/","//tiles4.usig.buenosaires.gob.ar/tilecache/","//tiles5.usig.buenosaires.gob.ar/tilecache/","//tiles6.usig.buenosaires.gob.ar/tilecache/","//tiles7.usig.buenosaires.gob.ar/tilecache/"]};if(typeof(usig)=="undefined"){usig={}}usig.GMLPlan=(function(b){var a;return{create:function(d,c){if(!OpenLayers){throw ("ERROR: OpenLayers is not loaded.");return null}if(!a){a=OpenLayers.Class(OpenLayers.Layer.Vector,{format:null,formatOptions:null,loaded:false,edges:null,markers:null,styleMap:null,rendererOptions:{zIndexing:true},initialize:function(g,f){var e=[];this.styleMap=this.getStyle(f.template,f.baseUrl,f.tipoRecorrido);e.push(g,{styleMap:this.styleMap});OpenLayers.Layer.Vector.prototype.initialize.apply(this,e);this.edges=new Array();this.markers=new Array()},loadFeatures:function(){var e={};OpenLayers.Util.extend(e,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){e.externalProjection=this.projection;e.internalProjection=this.map.getProjectionObject()}var f=this.format?new this.format(e):new OpenLayers.Format.GML(e);gml='<?xml version="1.0" encoding="utf-8"?><wfs:FeatureCollection xmlns:ms="http://mapserver.gis.umn.edu/mapserver" xmlns:wfs="http://www.opengis.net/wfs" xmlns:gml="http://www.opengis.net/gml">';gml+=this.edges.join();gml+=this.markers.join();gml+="</wfs:FeatureCollection>";this.loaded=true;this.addFeatures(f.read(gml));this.events.triggerEvent("loadend")},addMarker:function(e){this.markers.push("<gml:featureMember>"+e+"</gml:featureMember>")},addEdges:function(e){ls=this.edges;b.each(e,function(g,f){ls.push("<gml:featureMember>"+f+"</gml:featureMember>")})},setVisibility:function(e,f){OpenLayers.Layer.Vector.prototype.setVisibility.apply(this,arguments);if(this.visibility&&!this.loaded){this.events.triggerEvent("loadstart");this.loadFeatures()}},moveTo:function(g,e,f){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.events.triggerEvent("loadstart");this.loadFeatures()}},getFeatureByAttrId:function(h){var g=null;for(var f=0,e=this.features.length;f<e;++f){if(this.features[f].attributes.fid==h){g=this.features[f];break}}return g},highlightFeature:function(e){this.drawFeature(e,this.styleMap.styles.select)},setStyle:function(e){this.styleMap=e},getStyle:function(f,g,e){defaultOpacity=0.8;zIndexLine=8;zIndexPoint=9;zIndexMarker=14;lineOptions={strokeWidth:5,strokeOpacity:defaultOpacity,graphicZIndex:zIndexLine};lineOptionsWalk={strokeWidth:4,strokeDashstyle:"dashdot",strokeOpacity:defaultOpacity,graphicZIndex:zIndexLine};color=f.color;styleMap=new OpenLayers.StyleMap(OpenLayers.Util.applyDefaults({fillColor:color,fillOpacity:1,strokeColor:color,strokeWidth:3,strokeOpacity:1},OpenLayers.Feature.Vector.style["default"]));if(e=="transporte_publico"){var h={beginwalk:{Point:{pointRadius:12,graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/caminando.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},walk:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/recorrido_pie20x20.png",graphicZIndex:zIndexPoint},Line:lineOptionsWalk},beginbus:{Point:{pointRadius:12,graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/colectivo.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},bus:{Point:{pointRadius:12,externalGraphic:g+"images/recorrido_colectivo20x20.png",graphicWidth:20,graphicHeight:20,graphicZIndex:zIndexPoint},Line:lineOptions},subway:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/recorrido_subte20x20.png",graphicZIndex:zIndexPoint},Line:lineOptions},beginsubway:{Point:{pointRadius:12,graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/subte.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},subwayA:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/lineasubte-a.png",graphicZIndex:zIndexPoint},Line:lineOptions},subwayB:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/lineasubte-b.png",graphicZIndex:zIndexPoint},Line:lineOptions},subwayC:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/lineasubte-c.png",graphicZIndex:zIndexPoint},Line:lineOptions},subwayD:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/lineasubte-d.png",graphicZIndex:zIndexPoint},Line:lineOptions},subwayE:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/lineasubte-e.png",graphicZIndex:zIndexPoint},Line:lineOptions},subwayH:{Point:{pointRadius:12,graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/lineasubte-h.png",graphicZIndex:zIndexPoint},Line:lineOptions},connection:{Point:{pointRadius:6,graphicZIndex:zIndexPoint},Line:{strokeWidth:8,strokeOpacity:defaultOpacity,graphicZIndex:zIndexLine}},train:{Point:{pointRadius:12,externalGraphic:g+"images/recorrido_tren20x20.png",graphicWidth:20,graphicHeight:20,graphicZIndex:zIndexPoint},Line:lineOptions},begintrain:{Point:{pointRadius:12,graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/tren.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},marker:{Point:{pointRadius:12,externalGraphic:g+"images/llegada2.png",backgroundGraphic:g+"images/fondo_hasta.png",graphicXOffset:-10,graphicYOffset:-30,backgroundXOffset:-10,backgroundYOffset:-30,graphicWidth:24,graphicHeight:37,graphicZIndex:zIndexMarker},Line:lineOptions}}}else{if(e=="walk"){var h={beginwalk:{Point:{graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/caminando.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},walk:{Point:{graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/caminando.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},marker:{Point:{pointRadius:12,externalGraphic:g+"images/llegada2.png",backgroundGraphic:g+"images/fondo_hasta.png",graphicXOffset:-10,graphicYOffset:-30,backgroundXOffset:-10,backgroundYOffset:-30,graphicWidth:24,graphicHeight:37,graphicZIndex:zIndexMarker},Line:lineOptions}}}else{if(e=="car"){var h={car:{Point:{graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/auto.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptions},marker:{Point:{pointRadius:12,externalGraphic:g+"images/llegada2.png",backgroundGraphic:g+"images/fondo_hasta.png",graphicXOffset:-10,graphicYOffset:-30,backgroundXOffset:-10,backgroundYOffset:-30,graphicWidth:24,graphicHeight:37,graphicZIndex:zIndexMarker},Line:lineOptions}}}else{if(e=="bike"){walkColor=color;bikeColor=color;pointRadius=4;lineOptionsBike={strokeWidth:3,strokeColor:bikeColor,strokeOpacity:defaultOpacity,graphicZIndex:zIndexLine};lineOptionsWalk={strokeWidth:4,strokeColor:walkColor,strokeDashstyle:"dashdot",strokeOpacity:defaultOpacity,graphicZIndex:zIndexLine};var h={walk:{Point:{graphicWidth:20,graphicHeight:20,externalGraphic:g+"images/recorrido_pie20x20.png",graphicZIndex:zIndexPoint},Line:lineOptionsWalk},bike:{Point:{externalGraphic:g+"images/recorrido_bici20x20.png",graphicWidth:20,graphicHeight:20,graphicZIndex:zIndexPoint},Line:lineOptionsBike},"Carril preferencial":{Point:{pointRadius:pointRadius,fillColor:bikeColor,strokeColor:bikeColor,graphicWidth:35,graphicHeight:35,graphicZIndex:zIndexPoint},Line:lineOptionsBike},"Ciclovía":{Point:{pointRadius:pointRadius,fillColor:bikeColor,strokeColor:bikeColor,graphicWidth:35,graphicHeight:35,graphicZIndex:zIndexPoint},Line:lineOptionsBike},beginwalk:{Point:{pointRadius:12,graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/caminando.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsWalk},beginbike:{Point:{pointRadius:12,graphicWidth:24,graphicHeight:37,externalGraphic:g+"images/bici.png",graphicXOffset:-10,graphicYOffset:-30,backgroundGraphic:g+"images/fondo_desde.png",backgroundXOffset:-10,backgroundYOffset:-30,graphicZIndex:zIndexMarker},Line:lineOptionsBike},end:{Point:{pointRadius:12,externalGraphic:g+"images/llegada2.png",backgroundGraphic:g+"images/fondo_hasta.png",graphicXOffset:-10,graphicYOffset:-30,backgroundXOffset:-10,backgroundYOffset:-30,graphicWidth:24,graphicHeight:37,graphicZIndex:zIndexMarker},Line:lineOptions}}}}}}styleMap.addUniqueValueRules("default","type",h);return styleMap},CLASS_NAME:"usig.GMLPlan"})}return new a(d,c)}}})(jQuery);